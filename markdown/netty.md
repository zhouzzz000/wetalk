# netty

> netty是一个异步的事件驱动的网络框架，可以用于快速开发一个可维护的高性能协议服务端和客户端
>
> Netty是一种NIO客户端服务器框架，它支持网络应用程序(如协议服务器和客户端)的快速和轻松开发。它大大简化和简化了网络编程，如TCP和UDP套接字服务器。“快速和简单”并不意味着最终的应用程序会受到可维护性或性能问题的影响。Netty是根据许多协议(如FTP、SMTP、HTTP以及各种二进制和基于文本的协议)的实现所获得的经验精心设计的。因此，Netty成功地找到了一种在不妥协的情况下实现轻松开发、性能、稳定和灵活性的方法。

<img src="./images/components.png">

1. netty是一个提供了易于使用API的客户端/服务端框架
2. 并发高---NIO（非阻塞IO）
3. 传输快---零拷贝

## netty线程模型

1. 单线程模型：所有的操作都由同一个NIO线程处理

   > 所有I/O操作都由一个线程完成，即多路复用、事件分发和处理都是在一个Reactor线程上完成的。既要接收客户端的连接请求，向服务端发起连接，又要发送/读取请求或应答/响应消息。一个NIO线程同时处理成百上千的链路，性能上无法支撑，速度慢，若线程进入死循环，整个程序不可用，对于高负载、大并发的应用场景不合适。

2. 多线程模型

   > 有一个NIO线程（Acceptor）只负责监听服务端，接收客户端的TCP连接请求；NIO线程池负责网络IO的操作，即消息的读取、解码、编码和发送；1个NIO线程可以同时处理N条链路，但是1个链路只对应1个NIO线程，这是为了防止发生并发操作问题。但在并发百万客户端连接或需要安全认证时，一个Acceptor线程可能会存在性能不足问题

3. 主从多线程模型

   > 服务端用于接收客户端连接的不再是一个单独的 NIO 线程，而是一个独立的 NIO 线程池。Acceptor 接收到客户端 TCP连接请求并处理完成后（可能包含接入认证等），将新创建的 SocketChannel注 册 到 I/O 线 程 池（sub reactor 线 程 池）的某个I/O线程上， 由它负责SocketChannel 的读写和编解码工作。Acceptor 线程池仅仅用于客户端的登录、握手和安全认证，一旦链路建立成功，就将链路注册到后端 subReactor 线程池的 I/O 线程上，由 I/O 线程负责后续的 I/O 操作